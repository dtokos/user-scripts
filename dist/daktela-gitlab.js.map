{"version":3,"file":"daktela-gitlab.js","sources":["../src/services/gitlab/ui/icons.ts","../src/services/gitlab/ui/margins.ts","../src/services/gitlab/ui/tooltip.ts","../src/services/gitlab/ui/buttons.ts","../src/services/gitlab/ui/modals.ts","../src/services/gitlab/ui/inputs.ts","../src/services/gitlab/ui/containers.ts","../src/services/gitlab/ui/links.ts","../src/services/gitlab/ui.ts","../src/daktela/gitlab/button.ts","../src/daktela/gitlab/current.ts","../src/services/gitlab/gitlab.ts","../src/daktela/gitlab/cherry-picks.ts","../src/daktela/gitlab/parse.ts","../src/daktela/gitlab/comments.ts","../src/daktela/gitlab/copy-modal.ts","../src/daktela/gitlab/render.ts","../src/daktela/gitlab/features/copy-commit-as-comment/feature.ts","../src/daktela/gitlab/features/copy-commit-as-comment/inject.ts","../src/daktela/gitlab/main.ts"],"sourcesContent":["const icons = {\n\tdaktela(): HTMLImageElement {\n\t\tconst icon = document.createElement('img');\n\t\ticon.src = '/uploads/-/system/project/avatar/10/256x256.png';\n\t\ticon.style.width = '16px';\n\t\ticon.style.height = '16px';\n\t\ticon.style.transform = 'scale(1.5)';\n\n\t\treturn icon;\n\t},\n\tspinner(): HTMLSpanElement {\n\t\tconst spinner = document.createElement('span');\n\t\tspinner.classList.add('gl-spinner', 'gl-spinner-dark', 'gl-spinner-sm');\n\n\t\treturn spinner;\n\t},\n\tcheckCircle(): HTMLSpanElement {\n\t\tconst icon = wrappedSVGIcon('/assets/icons-7f1680a3670112fe4c8ef57b9dfb93f0f61b43a2a479d7abd6c83bcb724b9201.svg#status_success');\n\t\ticon.classList.add('ci-status-icon-success');\n\n\t\treturn icon;\n\t},\n\tcrossCircle(): HTMLSpanElement {\n\t\tconst icon = wrappedSVGIcon('/assets/icons-7f1680a3670112fe4c8ef57b9dfb93f0f61b43a2a479d7abd6c83bcb724b9201.svg#status_failed');\n\t\ticon.classList.add('ci-status-icon-failed');\n\n\t\treturn icon;\n\t},\n\tclose(): SVGSVGElement {\n\t\tconst icon = svgIcon('/assets/icons-7f1680a3670112fe4c8ef57b9dfb93f0f61b43a2a479d7abd6c83bcb724b9201.svg#close');\n\t\ticon.classList.add('gl-button-icon');\n\n\t\treturn icon;\n\t},\n\tclipboard(): SVGSVGElement {\n\t\tconst icon = svgIcon('/assets/icons-7f1680a3670112fe4c8ef57b9dfb93f0f61b43a2a479d7abd6c83bcb724b9201.svg#copy-to-clipboard');\n\t\ticon.classList.add('gl-icon');\n\n\t\treturn icon;\n\t}\n} as const;\n\nfunction wrappedSVGIcon(href: string): HTMLSpanElement {\n\tconst wrapper = document.createElement('span');\n\twrapper.appendChild(svgIcon(href));\n\n\treturn wrapper;\n}\n\nfunction svgIcon(href: string): SVGSVGElement {\n\tconst use = document.createElementNS('http://www.w3.org/2000/svg', 'use');\n\tuse.setAttribute('href', href);\n\n\tconst svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n\tsvg.classList.add('s16');\n\tsvg.appendChild(use);\n\n\treturn svg;\n}\n\nexport default icons;\n","const marginMap = {\n\t0: '0',\n\t1: '1',\n\t2: '2',\n\t3: '3',\n\t4: '4',\n\t5: '5',\n\t6: '6',\n\t7: '7',\n\t8: '8',\n} as const;\n\ntype Margin = keyof typeof marginMap;\n\nconst margins = {\n\tl(size: Margin): string {\n\t\treturn `gl-ml-${marginMap[size]}`;\n\t},\n\tr(size: Margin): string {\n\t\treturn `gl-mr-${marginMap[size]}`;\n\t},\n\tb(size: Margin): string {\n\t\treturn `gl-mb-${marginMap[size]}`;\n\t},\n} as const;\n\nexport default margins;\n","const placementMap = {\n\ttop: 'top',\n\tleft: 'left',\n\tright: 'right',\n\tbottom: 'bottom',\n} as const;\n\ntype Placement = keyof typeof placementMap;\n\nconst tooltip = {\n\tattach(element: HTMLElement, title: string, placement: Placement = 'top'): void {\n\t\telement.dataset.toggle = 'tooltip';\n\t\telement.dataset.title = title;\n\t\telement.dataset.placement = placement;\n\t\telement.dataset.container = 'body';\n\t},\n} as const;\n\nexport default tooltip;\n","import tooltip from './tooltip.ts';\nimport icons from './icons.ts';\n\nconst variantMap = {\n\t'default': 'btn-default',\n} as const;\n\nexport type Variant = keyof typeof variantMap;\n\nconst buttons = {\n\tdefault(title: string = ''): HTMLButtonElement {\n\t\treturn this.make(title, 'default');\n\t},\n\tmake(title: string = '', variant: Variant = 'default'): HTMLButtonElement {\n\t\tconst button = document.createElement('button');\n\t\tbutton.textContent = title;\n\t\tbutton.classList.add('btn', 'gl-button', variantMap[variant]);\n\n\t\treturn button;\n\t},\n\tcopy(content: string): HTMLButtonElement {\n\t\tconst button = document.createElement('button');\n\t\tbutton.classList.add('btn', 'btn-clipboard', 'gl-button', 'btn-default-tertiary', 'btn-icon', 'btn-sm');\n\t\tbutton.dataset.clipboardText = content;\n\t\ttooltip.attach(button, 'Copy');\n\t\tbutton.appendChild(icons.clipboard());\n\n\t\treturn button;\n\t},\n} as const;\n\nexport default buttons;\n","import icons from './icons.ts';\nimport buttons, { Variant as ButtonVariant } from './buttons.ts';\n\nexport type ModalBuilder = {\n\tsetTitle: (title: string) => ModalBuilder;\n\tsetBody: (body: HTMLElement) => ModalBuilder;\n\tappendBody: (body: HTMLElement) => ModalBuilder;\n\taddButton: (title: string, variant?: ButtonVariant) => ModalBuilder;\n\taddCloseButton: (title?: string) => ModalBuilder;\n\tbuild: () => Modal;\n};\n\nexport type Modal = {\n\topen: () => void;\n\tclose: () => void;\n};\n\ntype Config = {\n\ttitle: string,\n\tbody: HTMLElement[],\n\tbuttons: HTMLButtonElement[],\n};\n\nconst modals = {\n\tmake(): ModalBuilder {\n\t\tconst config: Config = {\n\t\t\ttitle: '',\n\t\t\tbody: [],\n\t\t\tbuttons: [],\n\t\t};\n\t\tlet element: HTMLDivElement|undefined = undefined;\n\n\t\treturn {\n\t\t\tsetTitle(title: string): ModalBuilder {\n\t\t\t\tconfig.title = title;\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetBody(body: HTMLElement): ModalBuilder {\n\t\t\t\tconfig.body = [body];\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tappendBody(body: HTMLElement): ModalBuilder {\n\t\t\t\tconfig.body.push(body);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\taddButton(title: string, variant: ButtonVariant = 'default'): ModalBuilder {\n\t\t\t\tconfig.buttons.push(buttons.make(title, variant));\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\taddCloseButton(title: string = 'Close'): ModalBuilder {\n\t\t\t\tconst button = buttons.default(title);\n\t\t\t\tbutton.dataset.dismiss = 'modal';\n\t\t\t\tconfig.buttons.push(button);\n\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tbuild(): Modal {\n\t\t\t\treturn {\n\t\t\t\t\topen(): void {\n\t\t\t\t\t\telement = buildModal(config);\n\t\t\t\t\t\t$(element).on('hidden.bs.modal', event => event.target.remove());\n\t\t\t\t\t\tdocument.body.appendChild(element);\n\n\t\t\t\t\t\t$(element).modal('show');\n\t\t\t\t\t},\n\t\t\t\t\tclose(): void {\n\t\t\t\t\t\tif (element !== undefined) {\n\t\t\t\t\t\t\t$(element).modal('hide');\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t},\n\t\t};\n\t},\n} as const;\n\nfunction buildModal(config: Config): HTMLDivElement {\n\tconst content = document.createElement('div');\n\tcontent.classList.add('modal-content');\n\tcontent.appendChild(buildHeader(config));\n\tcontent.appendChild(buildBody(config));\n\tcontent.appendChild(buildFooter(config));\n\n\tconst dialog = document.createElement('div');\n\tdialog.classList.add('modal-dialog');\n\tdialog.appendChild(content);\n\n\tconst modal = document.createElement('div');\n\tmodal.classList.add('modal', 'fade', 'gl-modal');\n\tmodal.appendChild(dialog);\n\n\treturn modal;\n}\n\nfunction buildHeader(config: Config): HTMLDivElement {\n\tconst title = document.createElement('h4');\n\ttitle.classList.add('modal-title');\n\ttitle.textContent = config.title;\n\n\tconst close = document.createElement('button');\n\tclose.classList.add('btn', 'btn-default', 'btn-sm', 'gl-button', 'btn-default-tertiary', 'btn-icon');\n\tclose.dataset.dismiss = 'modal';\n\tclose.appendChild(icons.close());\n\n\tconst header = document.createElement('div');\n\theader.classList.add('modal-header');\n\theader.appendChild(title);\n\theader.appendChild(close);\n\n\treturn header;\n}\n\nfunction buildBody(config: Config): HTMLDivElement {\n\tconst body = document.createElement('div');\n\tbody.classList.add('modal-body');\n\tconfig.body.forEach(element => body.appendChild(element));\n\n\treturn body;\n}\n\nfunction buildFooter(config: Config): HTMLDivElement {\n\tconst footer = document.createElement('div');\n\tfooter.classList.add('modal-footer');\n\tconfig.buttons.forEach(button => footer.appendChild(button));\n\n\treturn footer;\n}\n\nexport default modals;\n","const inputs = {\n\ttextArea(value: string = '', readOnly: boolean = false): HTMLTextAreaElement {\n\t\tconst textArea = document.createElement('textarea');\n\t\ttextArea.classList.add('gl-form-input', 'gl-form-textarea', 'form-control');\n\t\ttextArea.value = value;\n\t\ttextArea.readOnly = readOnly;\n\n\t\treturn textArea;\n\t},\n} as const;\n\nexport default inputs;\n","const containers = {\n\tjustifyBetween(...children: HTMLElement[]): HTMLDivElement {\n\t\tconst container = document.createElement('div');\n\t\tcontainer.classList.add('gl-display-flex', 'gl-justify-content-space-between');\n\t\tchildren.forEach(child => container.appendChild(child));\n\n\t\treturn container;\n\t},\n} as const;\n\nexport default containers;\n","const links = {\n\texternal(href: string, title: string|undefined = undefined) {\n\t\tconst anchor = document.createElement('a');\n\t\tanchor.href = href;\n\t\tanchor.textContent = title ?? href;\n\t\tanchor.target = '_blank';\n\t\tanchor.rel = 'noreferrer noopener';\n\n\t\treturn anchor;\n\t},\n} as const;\n\nexport default links;\n","import icons from './ui/icons.ts';\nimport margins from './ui/margins.ts';\nimport buttons from './ui/buttons.ts';\nimport tooltip from './ui/tooltip.ts';\nimport modals from './ui/modals.ts';\nimport inputs from './ui/inputs.ts';\nimport containers from './ui/containers.ts';\nimport links from './ui/links.ts';\n\nconst UI = {\n\tmargins,\n\ticons,\n\ttooltip,\n\tcontainers,\n\tbuttons,\n\tlinks,\n\tinputs,\n\tmodals,\n} as const;\n\nexport default UI;\n","import UI from '../../services/gitlab/ui.ts';\n\nconst DURATION = 1_500;\n\nfunction create(onClick: () => Promise<void>): HTMLButtonElement {\n\tconst button = UI.buttons.default();\n\tbutton.classList.add(UI.margins.l(3));\n\tUI.tooltip.attach(button, 'Copy commit message as Daktela comment', 'bottom');\n\tsetInitialState(button);\n\n\tbutton.addEventListener('click', async () => {\n\t\tsetLoadingState(button);\n\n\t\ttry {\n\t\t\tawait onClick();\n\t\t\tsetSuccessState(button);\n\t\t\tsetTimeout(() => setInitialState(button), DURATION);\n\t\t} catch (error) {\n\t\t\tsetErrorState(button);\n\t\t\tsetTimeout(() => setInitialState(button), DURATION);\n\n\t\t\tthrow error;\n\t\t}\n\t});\n\n\treturn button;\n}\n\nfunction setInitialState(button: HTMLButtonElement): void {\n\tconst icon = UI.icons.daktela();\n\ticon.classList.add(UI.margins.r(3));\n\n\tbutton.innerHTML = '';\n\tbutton.appendChild(icon);\n\tbutton.insertAdjacentText('beforeend', 'Daktela comment');\n\tbutton.disabled = false;\n}\n\nfunction setLoadingState(button: HTMLButtonElement): void {\n\tconst loadingIndicator = UI.icons.spinner();\n\tloadingIndicator.classList.add(UI.margins.r(3));\n\n\tbutton.innerHTML = '';\n\tbutton.appendChild(loadingIndicator);\n\tbutton.insertAdjacentText('beforeend', 'Loading...');\n\tbutton.disabled = true;\n}\n\nfunction setSuccessState(button: HTMLButtonElement): void {\n\tconst icon = UI.icons.checkCircle();\n\ticon.classList.add(UI.margins.r(3));\n\n\tbutton.innerHTML = '';\n\tbutton.appendChild(icon);\n\tbutton.insertAdjacentText('beforeend', 'Success');\n\tbutton.disabled = false;\n}\n\n\nfunction setErrorState(button: HTMLButtonElement): void {\n\tconst icon = UI.icons.crossCircle();\n\ticon.classList.add(UI.margins.r(3));\n\n\tbutton.innerHTML = '';\n\tbutton.appendChild(icon);\n\tbutton.insertAdjacentText('beforeend', 'Error');\n\tbutton.disabled = false;\n}\n\nexport default create;\n","import { ProjectRef, SHA } from '../../services/gitlab/types.ts';\n\nconst Current = {\n\tprojects: {\n\t\tref(): ProjectRef {\n\t\t\tconst matches = location.pathname.match(/^\\/?(.*)\\/-\\//);\n\n\t\t\tif (!matches) {\n\t\t\t\tthrow Error(`Could not parse project ref: ${location.pathname}`);\n\t\t\t}\n\n\t\t\treturn matches[1];\n\t\t},\n\t},\n\tcommits: {\n\t\tsha(): SHA {\n\t\t\tconst matches = location.pathname.match(/\\/-\\/commit\\/(\\w+)/);\n\n\t\t\tif (!matches) {\n\t\t\t\tthrow Error(`Could not parse commit SHA: ${location.pathname}`);\n\t\t\t}\n\n\t\t\treturn matches[1];\n\t\t},\n\t},\n} as const;\n\nexport default Current;\n","import { Branch, Comment, Commit, Ref, RefType, MergeRequest, ProjectRef, SHA } from './types.ts';\n\nconst BASE_URL = '/api/v4';\n\nconst GitLab = {\n\tcommits: {\n\t\tasync findBySHA(project: ProjectRef, sha: SHA): Promise<Commit> {\n\t\t\treturn get(`projects/${e(project)}/repository/commits/${sha}`);\n\t\t},\n\t\tasync refs(project: ProjectRef, sha: SHA, type: RefType|'all' = 'all'): Promise<Ref[]> {\n\t\t\treturn get(`projects/${e(project)}/repository/commits/${sha}/refs`, {type});\n\t\t},\n\t\tasync comments(project: ProjectRef, sha: SHA): Promise<Comment[]> {\n\t\t\treturn get(`projects/${e(project)}/repository/commits/${sha}/comments`);\n\t\t},\n\t\tasync mergeRequests(project: ProjectRef, sha: SHA): Promise<MergeRequest[]> {\n\t\t\treturn get(`projects/${e(project)}/repository/commits/${sha}/merge_requests`);\n\t\t},\n\t},\n\tbranches: {\n\t\tasync findByName(project: ProjectRef, name: string): Promise<Branch> {\n\t\t\treturn get(`projects/${e(project)}/repository/branches/${e(name)}`);\n\t\t},\n\t},\n} as const;\n\nfunction e(value: string|number|boolean): string {\n\treturn encodeURIComponent(value);\n}\n\nasync function get<TResponse>(endpoint: string, query: Record<string, string> = {}): Promise<TResponse> {\n\tconst url = new URL(`${BASE_URL}/${endpoint}`, location.origin);\n\tObject.entries(query)\n\t\t.forEach(([name, value]) => url.searchParams.append(name, value));\n\n\tlet response = await fetch(url);\n\n\treturn await response.json();\n}\n\nexport default GitLab;\n","import { Branch, Comment, ProjectRef, Ref, SHA } from '../../services/gitlab/types.ts';\nimport GitLab from '../../services/gitlab/gitlab.ts';\nimport { CommitWithBranch } from './types.ts';\n\nconst CherryPicks = {\n\tasync findRefs(project: ProjectRef, sha: SHA): Promise<CommitWithBranch<Ref[]>[]> {\n\t\tconst SHAs = await findSHAsForCommit(project, sha);\n\n\t\treturn Promise.all(\n\t\t\tSHAs.map(cherryPickSHA => this.findRef(project, cherryPickSHA))\n\t\t);\n\t},\n\tasync findRef(project: ProjectRef, sha: SHA): Promise<CommitWithBranch<Ref[]>> {\n\t\tconst [commit, branches] = await Promise.all([\n\t\t\tGitLab.commits.findBySHA(project, sha),\n\t\t\tGitLab.commits.refs(project, sha, 'branch'),\n\t\t]);\n\n\t\treturn {commit, branches};\n\t},\n\tasync deRefAll(project: ProjectRef, cherryPicks: CommitWithBranch<Ref>[]): Promise<CommitWithBranch<Branch>[]> {\n\t\treturn await Promise.all(\n\t\t\tcherryPicks.map(cherryPick => this.deRef(project, cherryPick))\n\t\t);\n\t},\n\tasync deRef(project: ProjectRef, cherryPick: CommitWithBranch<Ref>): Promise<CommitWithBranch<Branch>> {\n\t\tconst branch = await GitLab.branches.findByName(project, cherryPick.branch.name);\n\t\treturn {commit: cherryPick.commit, branch};\n\t},\n} as const;\n\nasync function findSHAsForCommit(project: ProjectRef, sha: SHA): Promise<SHA[]> {\n\tconst comments = await GitLab.commits.comments(project, sha);\n\treturn parseSHAsFromComments(comments);\n}\n\nfunction parseSHAsFromComments(comments: Comment[]): SHA[] {\n\treturn comments.reduce((SHAs, comment) => {\n\t\tconst matches = comment.note.match(/mentioned\\s+in\\s+commit\\s+(\\w+)/i);\n\n\t\tif (matches !== null) {\n\t\t\tSHAs.push(matches[1]);\n\t\t}\n\n\t\treturn SHAs;\n\t}, [] as SHA[]);\n}\n\nexport default CherryPicks;\n","import { Message } from './types.ts';\nimport { Commit } from '../../services/gitlab/types.ts';\n\nconst Parse = {\n\tmessage(commit: Commit): Message {\n\t\tconst message: Message = {title: '', body: '', ticket: undefined, extra: {}};\n\t\tconst lines = commit.message.split('\\n')\n\t\t\t.map(line => line.trim());\n\n\t\tskipEmptyLines(lines);\n\t\tmessage.title = parseTitle(lines);\n\t\tskipEmptyLines(lines);\n\n\t\twhile (lines.length) {\n\t\t\tprocessNextLine(message, lines);\n\t\t}\n\n\t\tmessage.body = message.body.trim();\n\n\t\treturn message;\n\t},\n} as const;\n\nfunction parseTitle(lines: string[]): string {\n\tconst title = lines.shift();\n\n\tif (title === undefined) {\n\t\tthrow Error('Could not parse commit title');\n\t}\n\n\treturn title.replace(/\\s*#\\s*\\d+\\s*$/, '');\n}\n\nfunction processNextLine(message: Message, lines: string[]): boolean {\n\treturn (\n\t\tskipCherryPicks(lines)\n\t\t|| collapseEmptyLines(message, lines)\n\t\t|| parseTicket(message, lines)\n\t\t|| parseExtra(message, lines)\n\t\t|| parseBody(message, lines)\n\t);\n}\n\nfunction skipEmptyLines(lines: string[]): boolean {\n\treturn skipWithPattern(lines, /^\\s*$/);\n}\n\nfunction skipCherryPicks(lines: string[]): boolean {\n\treturn skipWithPattern(lines, /\\(.*cherry.*picked.*\\)/i);\n}\n\nfunction skipWithPattern(lines: string[], pattern: RegExp): boolean {\n\tlet didSkip = false;\n\n\twhile (lines.length && lines[0].match(pattern)) {\n\t\tlines.shift();\n\t\tdidSkip = true;\n\t}\n\n\treturn didSkip;\n}\n\nfunction collapseEmptyLines(message: Message, lines: string[]): boolean {\n\tlet didCollapse = false;\n\n\tif (lines.length && lines[0].match(/^\\s*$/)) {\n\t\tmessage.body += '\\n';\n\t\tdidCollapse = true;\n\n\t\tskipEmptyLines(lines);\n\t}\n\n\treturn didCollapse;\n}\n\nfunction parseTicket(message: Message, lines: string[]): boolean {\n\tif (lines.length) {\n\t\tconst match = lines[0].match(/ticket\\s*:\\s*(http.*)/i);\n\n\t\tif (!match) {\n\t\t\treturn false;\n\t\t}\n\n\t\tmessage.ticket = match[1].trim();\n\t\tlines.shift();\n\t}\n\n\treturn true;\n}\n\nfunction parseExtra(message: Message, lines: string[]) {\n\tif (lines.length) {\n\t\tconst match = lines[0].match(/^([^:]+):\\s*(http.*)/i);\n\n\t\tif (!match) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst key = match[1].trim();\n\t\tconst value = match[2].trim();\n\n\t\tmessage.extra[key] = message.extra[key] ?? [];\n\t\tmessage.extra[key].push(value);\n\n\t\tlines.shift();\n\t}\n\n\treturn true;\n}\n\nfunction parseBody(message: Message, lines: string[]): boolean {\n\tconst nextLine = lines.shift();\n\n\tif (nextLine !== undefined) {\n\t\tmessage.body += `${nextLine}\\n`\n\t}\n\n\treturn nextLine !== undefined;\n}\n\nexport default Parse;\n","import { ProjectRef, Ref, SHA } from '../../services/gitlab/types.ts';\nimport GitLab from '../../services/gitlab/gitlab.ts';\nimport Gitlab from '../../services/gitlab/gitlab.ts';\nimport CherryPicks from './cherry-picks.ts';\nimport { Base, Comment } from './types.ts';\nimport Parse from './parse.ts';\n\nconst Comments = {\n\tasync assembleBase(project: ProjectRef, sha: SHA): Promise<Base<Ref[]>> {\n\t\tconst commit = await GitLab.commits.findBySHA(project, sha);\n\n\t\tconst [\n\t\t\tbranches,\n\t\t\tcherryPicks,\n\t\t\tmergeRequests,\n\t\t] = await Promise.all([\n\t\t\tGitLab.commits.refs(project, commit.id, 'all'),\n\t\t\tCherryPicks.findRefs(project, commit.id),\n\t\t\tGitLab.commits.mergeRequests(project, commit.id),\n\t\t]);\n\n\t\treturn {commit, branches, cherryPicks, mergeRequests};\n\t},\n\tasync assembleComment(project: ProjectRef, base: Base<Ref>): Promise<Comment> {\n\t\tconst [branch, cherryPicks] = await Promise.all([\n\t\t\tGitlab.branches.findByName(project, base.branch.name),\n\t\t\tCherryPicks.deRefAll(project, base.cherryPicks),\n\t\t]);\n\t\tconst message = Parse.message(base.commit);\n\n\t\treturn {\n\t\t\tcommit: base.commit,\n\t\t\tbranch,\n\t\t\tcherryPicks,\n\t\t\tmergeRequests: base.mergeRequests,\n\t\t\ttitle: message.title,\n\t\t\tbody: message.body,\n\t\t\tticket: message.ticket,\n\t\t\textra: message.extra,\n\t\t};\n\t},\n\ttryAutoResolveBase(base: Base<Ref[]>): Base<Ref>|null {\n\t\tif (\n\t\t\tbase.branches.length > 1\n\t\t\t|| base.cherryPicks.some(cherryPick => cherryPick.branches.length > 1)\n\t\t) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.resolveBaseUsingFirst(base);\n\t},\n\tresolveBaseUsingFirst(base: Base<Ref[]>): Base<Ref> {\n\t\treturn {\n\t\t\tcommit: base.commit,\n\t\t\tbranch: base.branches[0],\n\t\t\tcherryPicks: base.cherryPicks.map(cherryPick => ({\n\t\t\t\tcommit: cherryPick.commit,\n\t\t\t\tbranch: cherryPick.branches[0],\n\t\t\t})),\n\t\t\tmergeRequests: base.mergeRequests,\n\t\t};\n\t},\n} as const;\n\nexport default Comments;\n","import UI from '../../services/gitlab/ui.ts';\n\nfunction openCopyModal(content: string, description: HTMLElement|undefined = undefined): void {\n\tconst container = UI.containers.justifyBetween(\n\t\tbuildDescription(description),\n\t\tUI.buttons.copy(content),\n\t);\n\tcontainer.classList.add(UI.margins.b(2));\n\n\tconst modal = UI.modals.make()\n\t\t.setTitle('Copy')\n\t\t.appendBody(container)\n\t\t.appendBody(UI.inputs.textArea(content, true))\n\t\t.addCloseButton()\n\t\t.build();\n\n\tmodal.open();\n}\n\nfunction buildDescription(content: HTMLElement|undefined): HTMLDivElement {\n\tconst wrapper = document.createElement('div');\n\n\tif (content !== undefined) {\n\t\twrapper.appendChild(content);\n\t}\n\n\treturn wrapper;\n}\n\nexport default openCopyModal;\n","import { Comment, CommitWithBranch } from './types.ts';\nimport { Branch, Commit } from '../../services/gitlab/types.ts';\n\n// noinspection SpellCheckingInspection\nconst BODY_FONTS = [\n\t'Menlo',\n\t'\\'DejaVu Sans Mono\\'',\n\t'\\'Liberation Mono\\'',\n\t'Consolas',\n\t'\\'Ubuntu Mono\\'',\n\t'\\'Courier New\\'',\n\t'\\'andale mono\\'',\n\t'\\'lucida console\\'',\n\t'monospace'\n].join(', ');\n\nconst BODY_STYLES = [\n\t`font-family:${BODY_FONTS}`,\n\t'font-size:0.8125rem',\n\t'margin-top:8px',\n\t'margin-bottom:8px',\n\t'color:#999999',\n\t'padding:8px 0 8px 8px',\n\t'border-width:0 0 0 3px',\n\t'border-style:none none none solid',\n\t'border-color:#444444',\n].join(';');\n\nfunction render(comment: Comment): string {\n\treturn (\n\t\trenderTitle(comment)\n\t\t+ renderCommits(comment)\n\t\t+ renderMergeRequests(comment)\n\t\t+ renderExtra(comment)\n\t\t+ renderBody(comment)\n\t);\n}\n\nfunction renderTitle(comment: Comment): string {\n\treturn `<p><strong>${comment.title}</strong></p>`;\n}\n\nfunction renderCommits(comment: Comment): string {\n\treturn renderListWithTitle('Commits', renderCBs([comment as CommitWithBranch<Branch>].concat(comment.cherryPicks)));\n}\n\nfunction renderCBs(cbs: CommitWithBranch<Branch>[]): string[] {\n\treturn cbs.map(cb => `${renderBranch(cb.branch)} ${renderCommit(cb.commit)}`);\n}\n\nfunction renderBranch(branch: Branch): string {\n\treturn renderAnchor(branch.name, branch.web_url);\n}\n\nfunction renderCommit(commit: Commit): string {\n\treturn renderAnchor(commit.web_url, commit.web_url);\n}\n\nfunction renderMergeRequests(comment: Comment): string {\n\treturn renderListWithTitle('Merge requests', comment.mergeRequests.map(mr => linkify(mr.web_url)));\n}\n\nfunction renderExtra(comment: Comment): string {\n\treturn Object.entries(comment.extra)\n\t\t.reduce((html, [name, values]) => {\n\t\t\treturn html + renderListWithTitle(name, linkifyAll(values), true);\n\t\t}, '');\n}\n\nfunction renderBody(comment: Comment): string {\n\tif (comment.body === '') {\n\t\treturn '';\n\t}\n\n\treturn (\n\t\t`<p>Notes (copied from commit message):</p>`\n\t\t+ `<pre style=\"${BODY_STYLES}\">${comment.body}</pre>`\n\t);\n}\n\nfunction renderListWithTitle(title: string, items: string[], allowCollapse: boolean = false): string {\n\tif (!items.length) {\n\t\treturn '';\n\t}\n\n\tif (items.length === 1 && allowCollapse) {\n\t\treturn `<p>${title}: ${items[0]}</p>`;\n\t}\n\n\treturn (\n\t\t`<p>${title}:</p>`\n\t\t+ renderList(items)\n\t);\n}\n\nfunction renderList(items: string[]): string {\n\treturn `<ul>${items.map(item => `<li>${item}</li>`).join('')}</ul>`;\n}\n\nfunction renderAnchor(title: string, url: string): string {\n\treturn `<a href=\"${url}\" target=\"_blank\" rel=\"noreferrer noopener\">${title}</a>`;\n}\n\nfunction linkifyAll(values: string[]): string[] {\n\treturn values.map(linkify);\n}\n\nfunction linkify(value: string): string {\n\ttry {\n\t\treturn renderAnchor(value, new URL(value).toString());\n\t} catch {\n\t\treturn value;\n\t}\n}\n\nexport default render;\n","import { ProjectRef, SHA } from '../../../../services/gitlab/types.ts';\nimport Comments from '../../comments.ts';\nimport { Comment } from '../../types.ts';\nimport openCopyModal from '../../copy-modal.ts';\nimport render from '../../render.ts';\nimport UI from '../../../../services/gitlab/ui.ts';\n\nasync function copyCommitAsComment(project: ProjectRef, commit: SHA): Promise<void> {\n\tconst base = await Comments.assembleBase(project, commit);\n\t//const autoResolvedBase = Comments.tryAutoResolveBase(base);\n\tconst autoResolvedBase = Comments.resolveBaseUsingFirst(base);\n\n\tif (autoResolvedBase !== null) {\n\t\tconst comment = await Comments.assembleComment(project, autoResolvedBase);\n\t\topenCopy(comment);\n\t} else {\n\t\t// TODO: Implement modal\n\t\tthrow Error('Comment could not be auto-resolved');\n\t}\n}\n\nfunction openCopy(comment: Comment): void {\n\topenCopyModal(render(comment), ticketDescription(comment));\n}\n\nfunction ticketDescription(comment: Comment): HTMLSpanElement|undefined {\n\tif (!comment.ticket) {\n\t\treturn undefined;\n\t}\n\n\tconst span = document.createElement('span');\n\tspan.textContent = 'Ticket: ';\n\tspan.appendChild(UI.links.external(comment.ticket));\n\n\treturn span;\n}\n\nexport default copyCommitAsComment;\n","import createButton from '../../button.ts';\nimport Current from '../../current.ts';\nimport copyCommitAsComment from './feature.ts';\n\nfunction inject(): void {\n\tconst header = document.querySelector('.page-content-header');\n\tif (!header) return;\n\n\theader.appendChild(createButton(processComment));\n}\n\nasync function processComment(): Promise<void> {\n\tconst currentProject = Current.projects.ref();\n\tconst currentSHA = Current.commits.sha();\n\n\tawait copyCommitAsComment(currentProject, currentSHA);\n}\n\nexport default inject;\n","import injectCopyCommitAsComment from './features/copy-commit-as-comment/inject.ts';\n\ninjectCopyCommitAsComment();\n"],"names":["icons","icon","spinner","wrappedSVGIcon","svgIcon","href","wrapper","use","svg","marginMap","margins","size","tooltip","element","title","placement","variantMap","buttons","variant","button","content","modals","config","body","buildModal","event","buildHeader","buildBody","buildFooter","dialog","modal","close","header","footer","inputs","value","readOnly","textArea","containers","children","container","child","links","anchor","UI","DURATION","create","onClick","setInitialState","setLoadingState","setSuccessState","error","setErrorState","loadingIndicator","Current","matches","BASE_URL","GitLab","project","sha","get","e","type","name","endpoint","query","url","CherryPicks","SHAs","findSHAsForCommit","cherryPickSHA","commit","branches","cherryPicks","cherryPick","branch","comments","parseSHAsFromComments","comment","Parse","message","lines","line","skipEmptyLines","parseTitle","processNextLine","skipCherryPicks","collapseEmptyLines","parseTicket","parseExtra","parseBody","skipWithPattern","pattern","didSkip","didCollapse","match","key","nextLine","Comments","mergeRequests","base","Gitlab","openCopyModal","description","buildDescription","BODY_FONTS","BODY_STYLES","render","renderTitle","renderCommits","renderMergeRequests","renderExtra","renderBody","renderListWithTitle","renderCBs","cbs","cb","renderBranch","renderCommit","renderAnchor","linkify","mr","html","values","linkifyAll","items","allowCollapse","renderList","item","copyCommitAsComment","autoResolvedBase","openCopy","ticketDescription","span","inject","createButton","processComment","currentProject","currentSHA","injectCopyCommitAsComment"],"mappings":"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"}